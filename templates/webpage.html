{% extends "base.html" %}

{% block title %}ç¶²é æ°´å° - é›™é‡æ°´å°ç³»çµ±{% endblock %}

{% block content %}
<div class="webpage-watermark-container">
    <div class="page-header">
        <h1>ğŸŒ ç¶²é æ°´å°ç³»çµ±</h1>
        <p class="subtitle">ç‚ºç¶²é å…§å®¹æ·»åŠ æ˜ç¢¼èˆ‡éš±ç¢¼é›™é‡æ°´å°ä¿è­·</p>
        <a href="/" class="back-link">â† è¿”å›é¦–é </a>
    </div>
    
    <div class="watermark-demo-layout">
        <!-- å·¦å´æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <div class="panel-header">
                <h2>âš™ï¸ æ°´å°è¨­å®š</h2>
                <div class="quick-actions">
                    <button onclick="applyVisibleWatermark()" class="btn btn-primary btn-sm">
                        <span class="icon">âœ“</span> å¥—ç”¨
                    </button>
                    <button onclick="removeVisibleWatermark()" class="btn btn-secondary btn-sm">
                        <span class="icon">âœ•</span> ç§»é™¤
                    </button>
                    <button onclick="resetWatermarkSettings()" class="btn btn-outline btn-sm">
                        <span class="icon">â†»</span> é‡ç½®
                    </button>
                </div>
            </div>
            
            <div class="panel-tabs">
                <button class="tab-btn active" onclick="showTab('basic', this)">åŸºæœ¬è¨­å®š</button>
                <button class="tab-btn" onclick="showTab('style', this)">æ¨£å¼è¨­å®š</button>
                <button class="tab-btn" onclick="showTab('advanced', this)">é€²éšè¨­å®š</button>
            </div>
            
            <!-- åŸºæœ¬è¨­å®šæ¨™ç±¤é  -->
            <div id="tab-basic" class="tab-content active">
                <div class="form-group">
                    <label>
                        <span class="label-text">æ°´å°æ–‡å­—</span>
                        <span class="label-hint">é¡¯ç¤ºåœ¨æ°´å°ä¸Šçš„æ–‡å­—</span>
                    </label>
                    <input type="text" id="watermark_txt" value="æ©Ÿå¯†æ–‡ä»¶" placeholder="è¼¸å…¥æ°´å°æ–‡å­—" />
                </div>
                
                <div class="form-group">
                    <label>
                        <span class="label-text">ç›®æ¨™å€åŸŸ</span>
                        <span class="label-hint">é¸æ“‡è¦æ‡‰ç”¨æ°´å°çš„å€åŸŸ</span>
                    </label>
                    <select id="target_area" onchange="updateParentNode()">
                        <option value="preview_area">æ•´å€‹é è¦½å€åŸŸ</option>
                        <option value="yahoo-header">Yahoo æ¨™é¡Œå€</option>
                        <option value="yahoo-content">Yahoo å…§å®¹å€</option>
                        <option value="yahoo-sidebar">Yahoo å´é‚Šæ¬„</option>
                        <option value="yahoo-footer">Yahoo é å°¾</option>
                        <option value="custom">è‡ªè¨‚ ID</option>
                    </select>
                </div>
                
                <div class="form-group" id="custom-id-group" style="display: none;">
                    <label>
                        <span class="label-text">è‡ªè¨‚å…ƒç´  ID</span>
                        <span class="label-hint">è¼¸å…¥ç›®æ¨™å…ƒç´ çš„ ID</span>
                    </label>
                    <input type="text" id="watermark_parent_node" value="preview_area" placeholder="ä¾‹å¦‚: preview_area" />
                </div>
                
                <div class="form-group">
                    <label>
                        <span class="label-text">é€æ˜åº¦</span>
                        <span class="label-hint" id="alpha_value">0.15</span>
                    </label>
                    <input type="range" id="watermark_alpha" min="0" max="1" step="0.05" value="0.15" />
                </div>
                
                <div class="form-group">
                    <label>
                        <span class="label-text">æ—‹è½‰è§’åº¦</span>
                        <span class="label-hint">æ°´å°æ—‹è½‰è§’åº¦ï¼ˆåº¦ï¼‰</span>
                    </label>
                    <input type="range" id="watermark_angle" min="-180" max="180" value="15" />
                    <span class="range-value" id="angle_value">15Â°</span>
                </div>
            </div>
            
            <!-- æ¨£å¼è¨­å®šæ¨™ç±¤é  -->
            <div id="tab-style" class="tab-content">
                <div class="form-group">
                    <label>
                        <span class="label-text">å­—é«”</span>
                    </label>
                    <select id="watermark_font">
                        <option value="å¾®è»Ÿé›…é»‘" selected>å¾®è»Ÿé›…é»‘</option>
                        <option value="Arial">Arial</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Courier New">Courier New</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>
                        <span class="label-text">å­—é«”å¤§å°</span>
                    </label>
                    <input type="text" id="watermark_fontsize" value="18px" placeholder="ä¾‹å¦‚: 18px" />
                </div>
                
                <div class="form-group">
                    <label>
                        <span class="label-text">é¡è‰²</span>
                    </label>
                    <div class="color-input-group">
                        <input type="color" id="watermark_color" value="#000000" />
                        <input type="text" id="watermark_color_text" value="#000000" placeholder="#000000" />
                    </div>
                </div>
                
                <div class="form-group">
                    <label>
                        <span class="label-text">æ°´å°å¯¬åº¦</span>
                    </label>
                    <input type="number" id="watermark_width" value="100" min="0" />
                    <span class="unit">px</span>
                </div>
                
                <div class="form-group">
                    <label>
                        <span class="label-text">æ°´å°é«˜åº¦</span>
                    </label>
                    <input type="number" id="watermark_height" value="100" min="0" />
                    <span class="unit">px</span>
                </div>
            </div>
            
            <!-- é€²éšè¨­å®šæ¨™ç±¤é  -->
            <div id="tab-advanced" class="tab-content">
                <div class="form-group">
                    <label>
                        <span class="label-text">èµ·å§‹ X åº§æ¨™</span>
                    </label>
                    <input type="number" id="watermark_x" value="20" min="0" />
                    <span class="unit">px</span>
                </div>
                
                <div class="form-group">
                    <label>
                        <span class="label-text">èµ·å§‹ Y åº§æ¨™</span>
                    </label>
                    <input type="number" id="watermark_y" value="20" min="0" />
                    <span class="unit">px</span>
                </div>
                
                <div class="form-group">
                    <label>
                        <span class="label-text">è¡Œæ•¸ (0=è‡ªå‹•)</span>
                    </label>
                    <input type="number" id="watermark_rows" value="0" min="0" />
                </div>
                
                <div class="form-group">
                    <label>
                        <span class="label-text">åˆ—æ•¸ (0=è‡ªå‹•)</span>
                    </label>
                    <input type="number" id="watermark_cols" value="0" min="0" />
                </div>
                
                <div class="form-group">
                    <label>
                        <span class="label-text">X è»¸é–“éš”</span>
                    </label>
                    <input type="number" id="watermark_x_space" value="50" min="0" />
                    <span class="unit">px</span>
                </div>
                
                <div class="form-group">
                    <label>
                        <span class="label-text">Y è»¸é–“éš”</span>
                    </label>
                    <input type="number" id="watermark_y_space" value="50" min="0" />
                    <span class="unit">px</span>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="monitor" checked />
                        <span class="label-text">å•Ÿç”¨é˜²åˆªé™¤ç›£è½</span>
                    </label>
                </div>
            </div>
            
            <!-- éš±ç¢¼æ°´å°å€ -->
            <div class="invisible-watermark-section">
                <h3>ğŸ” éš±ç¢¼æ°´å°</h3>
                <div class="form-group">
                    <label>
                        <span class="label-text">éš±è—æ–‡å­—</span>
                        <span class="label-hint">ä½¿ç”¨é›¶å¯¬å­—ç¬¦åµŒå…¥</span>
                    </label>
                    <input type="text" id="invisible_text" value="UserID:12345" placeholder="è¼¸å…¥è¦éš±è—çš„æ–‡å­—" />
                </div>
                <div class="btn-group">
                    <button onclick="applyInvisibleWatermark()" class="btn btn-primary btn-sm">åµŒå…¥</button>
                    <button onclick="extractInvisibleWatermark()" class="btn btn-success btn-sm">æå–</button>
                </div>
                <div id="extracted_result" class="result"></div>
            </div>
        </div>
        
        <!-- å³å´é è¦½å€åŸŸ -->
        <div class="preview-panel">
            <div class="preview-header">
                <h2>ğŸ“„ é è¦½å€åŸŸ</h2>
                <div class="preview-actions">
                    <button onclick="highlightTargetArea()" class="btn-icon" title="é«˜äº®ç›®æ¨™å€åŸŸ">
                        <span>ğŸ”</span>
                    </button>
                </div>
            </div>
            
            <!-- å‡çš„ Yahoo é¦–é  -->
            <div id="preview_area" class="yahoo-preview">
                <!-- Yahoo æ¨™é¡Œå€ -->
                <div id="yahoo-header" class="yahoo-header">
                    <div class="yahoo-logo">
                        <span class="yahoo-text">YAHOO!</span>
                    </div>
                    <div class="yahoo-search">
                        <input type="text" placeholder="æœå°‹ç¶²é ã€åœ–ç‰‡ã€å½±ç‰‡..." />
                        <button>æœå°‹</button>
                    </div>
                    <div class="yahoo-nav">
                        <a href="#">éƒµä»¶</a>
                        <a href="#">æ–°è</a>
                        <a href="#">è²¡ç¶“</a>
                        <a href="#">é‹å‹•</a>
                        <a href="#">å¨›æ¨‚</a>
                    </div>
                </div>
                
                <!-- Yahoo ä¸»å…§å®¹å€ -->
                <div class="yahoo-main">
                    <div id="yahoo-content" class="yahoo-content">
                        <div class="news-section">
                            <h3>ğŸ“° ç†±é–€æ–°è</h3>
                            <ul class="news-list">
                                <li><a href="#">ç§‘æŠ€è‚¡å¤§æ¼²ï¼ŒæŠ•è³‡äººçœ‹å¥½æœªä¾†å‰æ™¯</a></li>
                                <li><a href="#">å…¨çƒæ°£å€™è®Šé·æœƒè­°é”æˆé‡è¦å”è­°</a></li>
                                <li><a href="#">æ–°ä¸–ä»£é›»å‹•è»ŠæŠ€è¡“çªç ´æ€§é€²å±•</a></li>
                                <li><a href="#">åœ‹éš›é«”è‚²è³½äº‹ç²¾å½©å›é¡§</a></li>
                                <li><a href="#">å¥åº·ç”Ÿæ´»ï¼šå°ˆå®¶åˆ†äº«é¤Šç”Ÿç§˜è¨£</a></li>
                            </ul>
                        </div>
                        
                        <div class="featured-section">
                            <h3>â­ ç²¾é¸å…§å®¹</h3>
                            <div class="featured-grid">
                                <div class="featured-item">
                                    <img src="https://via.placeholder.com/200x150?text=åœ–ç‰‡1" alt="ç²¾é¸1" />
                                    <h4>æ·±åº¦å ±å°ï¼šç§‘æŠ€å‰µæ–°è¶¨å‹¢</h4>
                                    <p>æ¢ç´¢æœ€æ–°ç§‘æŠ€ç™¼å±•èˆ‡æœªä¾†è¶¨å‹¢...</p>
                                </div>
                                <div class="featured-item">
                                    <img src="https://via.placeholder.com/200x150?text=åœ–ç‰‡2" alt="ç²¾é¸2" />
                                    <h4>è²¡ç¶“åˆ†æï¼šå¸‚å ´å‹•æ…‹è§€å¯Ÿ</h4>
                                    <p>å°ˆæ¥­åˆ†æå¸«è§£è®€å¸‚å ´è®ŠåŒ–...</p>
                                </div>
                                <div class="featured-item">
                                    <img src="https://via.placeholder.com/200x150?text=åœ–ç‰‡3" alt="ç²¾é¸3" />
                                    <h4>ç”Ÿæ´»é¢¨æ ¼ï¼šæ™‚å°šèˆ‡è¨­è¨ˆ</h4>
                                    <p>æœ€æ–°æ™‚å°šè¶¨å‹¢èˆ‡è¨­è¨ˆéˆæ„Ÿ...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Yahoo å´é‚Šæ¬„ -->
                    <div id="yahoo-sidebar" class="yahoo-sidebar">
                        <div class="widget">
                            <h4>ğŸ“Š ä»Šæ—¥å¤©æ°£</h4>
                            <div class="weather-info">
                                <div class="temp">25Â°C</div>
                                <div class="condition">å¤šé›²</div>
                            </div>
                        </div>
                        
                        <div class="widget">
                            <h4>ğŸ’° è‚¡å¸‚è¡Œæƒ…</h4>
                            <ul class="stock-list">
                                <li>å°ç©é›» <span class="up">+2.5%</span></li>
                                <li>è¯ç™¼ç§‘ <span class="up">+1.8%</span></li>
                                <li>é´»æµ· <span class="down">-0.5%</span></li>
                            </ul>
                        </div>
                        
                        <div class="widget">
                            <h4>ğŸ¯ ç†±é–€è©±é¡Œ</h4>
                            <ul class="trending-list">
                                <li>#ç§‘æŠ€å‰µæ–°</li>
                                <li>#ç’°ä¿è­°é¡Œ</li>
                                <li>#å¥åº·ç”Ÿæ´»</li>
                                <li>#æŠ•è³‡ç†è²¡</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Yahoo é å°¾ -->
                <div id="yahoo-footer" class="yahoo-footer">
                    <div class="footer-links">
                        <a href="#">é—œæ–¼ Yahoo</a>
                        <a href="#">éš±ç§æ¬Šæ”¿ç­–</a>
                        <a href="#">æœå‹™æ¢æ¬¾</a>
                        <a href="#">è¯çµ¡æˆ‘å€‘</a>
                    </div>
                    <div class="copyright">
                        <p>Â© 2025 Yahoo Inc. ç‰ˆæ¬Šæ‰€æœ‰</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/webpage-watermark.css">
{% endblock %}

{% block extra_js %}
<script>
// æ¨™ç±¤é åˆ‡æ›
function showTab(tabName, element) {
    // éš±è—æ‰€æœ‰æ¨™ç±¤å…§å®¹
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„ active ç‹€æ…‹
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // é¡¯ç¤ºé¸ä¸­çš„æ¨™ç±¤
    document.getElementById('tab-' + tabName).classList.add('active');
    
    // è¨­ç½®æŒ‰éˆ•ç‚º active ç‹€æ…‹
    if (element) {
        element.classList.add('active');
    } else {
        // å¦‚æœæ²’æœ‰å‚³å…¥ elementï¼Œé€šéæŸ¥æ‰¾å°æ‡‰çš„æŒ‰éˆ•
        document.querySelectorAll('.tab-btn').forEach(btn => {
            if (btn.textContent.trim().includes(tabName === 'basic' ? 'åŸºæœ¬' : tabName === 'style' ? 'æ¨£å¼' : 'é€²éš')) {
                btn.classList.add('active');
            }
        });
    }
}

// æ›´æ–°é€æ˜åº¦é¡¯ç¤º
document.getElementById('watermark_alpha').addEventListener('input', function() {
    document.getElementById('alpha_value').textContent = this.value;
});

// æ›´æ–°è§’åº¦é¡¯ç¤º
document.getElementById('watermark_angle').addEventListener('input', function() {
    document.getElementById('angle_value').textContent = this.value + 'Â°';
});

// é¡è‰²åŒæ­¥
document.getElementById('watermark_color').addEventListener('input', function() {
    document.getElementById('watermark_color_text').value = this.value;
});

document.getElementById('watermark_color_text').addEventListener('input', function() {
    if (/^#[0-9A-F]{6}$/i.test(this.value)) {
        document.getElementById('watermark_color').value = this.value;
    }
});

// æ›´æ–°ç›®æ¨™å€åŸŸ
function updateParentNode() {
    const targetArea = document.getElementById('target_area').value;
    const customGroup = document.getElementById('custom-id-group');
    const parentNodeInput = document.getElementById('watermark_parent_node');
    
    if (targetArea === 'custom') {
        customGroup.style.display = 'block';
    } else {
        customGroup.style.display = 'none';
        parentNodeInput.value = targetArea;
    }
}

// é«˜äº®ç›®æ¨™å€åŸŸ
function highlightTargetArea() {
    const targetArea = document.getElementById('target_area').value;
    const element = document.getElementById(targetArea);
    
    if (element) {
        // ç§»é™¤ä¹‹å‰çš„é«˜äº®
        document.querySelectorAll('.highlight-target').forEach(el => {
            el.classList.remove('highlight-target');
        });
        
        // æ·»åŠ é«˜äº®
        element.classList.add('highlight-target');
        
        // æ»¾å‹•åˆ°ç›®æ¨™å€åŸŸ
        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        // 3ç§’å¾Œç§»é™¤é«˜äº®
        setTimeout(() => {
            element.classList.remove('highlight-target');
        }, 3000);
        
        Utils.showMessage('å·²é«˜äº®ç›®æ¨™å€åŸŸ: ' + targetArea, 'info');
    }
}

function applyVisibleWatermark() {
    const targetArea = document.getElementById('target_area').value;
    const parentNode = targetArea === 'custom' 
        ? document.getElementById('watermark_parent_node').value.trim()
        : targetArea;
    
    const config = {
        watermark_id: 'wm_div_id',
        watermark_prefix: 'mask_div_id',
        watermark_txt: document.getElementById('watermark_txt').value || 'æ©Ÿå¯†æ–‡ä»¶',
        watermark_x: parseInt(document.getElementById('watermark_x').value) || 20,
        watermark_y: parseInt(document.getElementById('watermark_y').value) || 20,
        watermark_rows: parseInt(document.getElementById('watermark_rows').value) || 0,
        watermark_cols: parseInt(document.getElementById('watermark_cols').value) || 0,
        watermark_x_space: parseInt(document.getElementById('watermark_x_space').value) || 50,
        watermark_y_space: parseInt(document.getElementById('watermark_y_space').value) || 50,
        watermark_font: document.getElementById('watermark_font').value || 'å¾®è»Ÿé›…é»‘',
        watermark_color: document.getElementById('watermark_color').value || '#000000',
        watermark_fontsize: document.getElementById('watermark_fontsize').value || '18px',
        watermark_alpha: parseFloat(document.getElementById('watermark_alpha').value) || 0.15,
        watermark_width: parseInt(document.getElementById('watermark_width').value) || 100,
        watermark_height: parseInt(document.getElementById('watermark_height').value) || 100,
        watermark_angle: parseInt(document.getElementById('watermark_angle').value) || 15,
        watermark_parent_width: 0,
        watermark_parent_height: 0,
        watermark_parent_node: parentNode || null,
        monitor: document.getElementById('monitor').checked
    };
    
    WebpageWatermark.applyVisible(config);
    Utils.showMessage('âœ“ æ˜ç¢¼æ°´å°å·²å¥—ç”¨åˆ°: ' + (parentNode || 'æ•´å€‹é é¢'), 'success');
}

function removeVisibleWatermark() {
    try {
        if (typeof watermark !== 'undefined' && typeof watermark.remove === 'function') {
            watermark.remove();
        }
        
        const watermarkId = 'wm_div_id';
        const watermarkPrefix = 'mask_div_id';
        
        // ç§»é™¤ä¸»å®¹å™¨
        const mainWatermarkDiv = document.getElementById(watermarkId);
        if (mainWatermarkDiv) mainWatermarkDiv.remove();
        
        // ç§»é™¤æ‰€æœ‰å‰ç¶´å…ƒç´ 
        document.querySelectorAll(`[id^="${watermarkPrefix}"]`).forEach(el => el.remove());
        
        // å»¶é²å†æ¬¡æª¢æŸ¥
        setTimeout(() => {
            document.querySelectorAll(`#${watermarkId}, [id^="${watermarkPrefix}"]`).forEach(el => el.remove());
        }, 100);
        
        Utils.showMessage('âœ“ æ˜ç¢¼æ°´å°å·²ç§»é™¤', 'success');
    } catch (error) {
        console.error('ç§»é™¤æ°´å°æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
        Utils.showMessage('ç§»é™¤å¤±æ•—: ' + error.message, 'error');
    }
}

function resetWatermarkSettings() {
    removeVisibleWatermark();
    
    setTimeout(() => {
        document.getElementById('watermark_txt').value = 'æ©Ÿå¯†æ–‡ä»¶';
        document.getElementById('target_area').value = 'preview_area';
        document.getElementById('watermark_parent_node').value = 'preview_area';
        document.getElementById('watermark_alpha').value = '0.15';
        document.getElementById('alpha_value').textContent = '0.15';
        document.getElementById('watermark_angle').value = '15';
        document.getElementById('angle_value').textContent = '15Â°';
        document.getElementById('watermark_font').value = 'å¾®è»Ÿé›…é»‘';
        document.getElementById('watermark_color').value = '#000000';
        document.getElementById('watermark_color_text').value = '#000000';
        document.getElementById('watermark_fontsize').value = '18px';
        document.getElementById('watermark_width').value = '100';
        document.getElementById('watermark_height').value = '100';
        document.getElementById('watermark_x').value = '20';
        document.getElementById('watermark_y').value = '20';
        document.getElementById('watermark_rows').value = '0';
        document.getElementById('watermark_cols').value = '0';
        document.getElementById('watermark_x_space').value = '50';
        document.getElementById('watermark_y_space').value = '50';
        document.getElementById('monitor').checked = true;
        updateParentNode();
        
        Utils.showMessage('âœ“ å·²é‡ç½®ç‚ºé è¨­å€¼', 'success');
    }, 300);
}

function applyInvisibleWatermark() {
    const text = document.getElementById('invisible_text').value;
    const targetArea = document.getElementById('target_area').value;
    const targetElement = document.getElementById(targetArea);
    
    if (targetElement) {
        WebpageWatermark.applyInvisible(text, `#${targetArea} p, #${targetArea} a`);
        Utils.showMessage('âœ“ éš±ç¢¼æ°´å°å·²åµŒå…¥åˆ°: ' + targetArea, 'success');
    } else {
        Utils.showMessage('ç›®æ¨™å€åŸŸä¸å­˜åœ¨', 'error');
    }
}

function extractInvisibleWatermark() {
    const extracted = WebpageWatermark.extractInvisible();
    const resultDiv = document.getElementById('extracted_result');
    
    if (extracted) {
        resultDiv.innerHTML = `
            <div class="alert alert-success">
                <strong>æå–æˆåŠŸï¼</strong><br>
                éš±ç¢¼æ°´å°: <code>${extracted}</code>
            </div>
        `;
    } else {
        resultDiv.innerHTML = `
            <div class="alert alert-warning">
                æœªæ‰¾åˆ°éš±ç¢¼æ°´å°
            </div>
        `;
    }
}
</script>
{% endblock %}
